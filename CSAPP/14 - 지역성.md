# 지역성

잘 작성한 컴퓨터 프로그램은 좋은 **지역성(locality)**을 보여준다. 즉, 이들은 다른 최근에 참조했던 데이터 아이템 근처의 데이터 아이템이나 최근에 자신을 참조했던 데이터 아이템을 참조하려는 경향이 있다.

- **시간 지역성**: 좋은 시간 지역성을 갖는 프로그램에서는 한번 참조된 메모리 위치는 가까운 미래에 다시 여러 번 참조될 가능성이 크다.
- **공간 지역성**: 좋은 공간 지역성을 갖는 프로그램에서는 만일 어떤 메모리 위치가 일단 참조되면, 이 프로그램은 가까운 미래에 근처의 메모리 위치를 참조할 가능성이 크다.

좋은 지역성을 가진 프로그램이 더 빠르므로 프로그래머는 지역성의 원리를 이해해야 한다. 

---

## 프로그램 데이터 참조의 지역성

벡터의 각 원소를 순차적으로 방문하는 함수는 **stride-1 참조 패턴**을 가진다고 말한다.(**순차 참조 패턴**이라고도 말한다.) 연속적인 벡터의 매 *k*번째 원소를 방문하는 것을 **stride-k 참조 패턴**이라고 부른다. 일반적으로 stride가 증가하면 공간 지역성은 감소한다.

벡터의 원소들을 더하는 간단한 함수 두 가지를 보자.

```cpp
int sumArrayRows(int a[ROW][COL])
{
    int i , j, sum = 0;
    
    // 행(row)우선 접근
    for(int i = 0; i < ROW; ++i)
        for(int j = 0; j < COL; ++j)
            sum += a[i][j];
    
    return sum;
}
```

| Address      | 0    | 4    | 8    | 12   | 16   | 20   |
| ------------ | ---- | ---- | ---- | ---- | ---- | ---- |
| Contents     | a00  | a01  | a02  | a10  | a11  | a12  |
| Access order | 1    | 2    | 3    | 4    | 5    | 6    |

위 프로그램에서 이중으로 중첩된 루프는 배열의 원소들을 **행우선 순서**로 읽는다. 즉, 내부 루프는 첫 번째 행의 원소들을 읽으며, 다음으로 두 번째 행 이런 식으로 진행한다. *sumArrayRows* 함수는 배열에 저장된 것과 같은 행우선 순서로 참조하기 때문에 좋은 공간 지역성을 가진다. (stride-1 참조 패턴)

```cpp
int sumArrayCols(int a[ROW][COL])
{
    int i , j, sum = 0;
    
    // 열(column)우선 접근
    for(int j = 0; j < COL; ++j)
        for(int i = 0; i < ROW; ++i)
            sum += a[i][j];
    
    return sum;
}
```

| Address      | 0    | 4    | 8    | 12   | 16   | 20   |
| ------------ | ---- | ---- | ---- | ---- | ---- | ---- |
| Contents     | a00  | a01  | a02  | a10  | a11  | a12  |
| Access order | 1    | 3    | 5    | 2    | 4    | 6    |

*sumArrayCols* 함수는 나쁜 공간 지역을 가지는데, 그 이유는 이 함수가 배열을 행 방향 대신 **열우선 순서**로 스캔하기 때문이다. 그 결과 stride-N 참조 패턴이 된다.

---